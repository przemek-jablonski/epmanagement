<?php

namespace TicketBundle\Repository;

use Doctrine\ORM\EntityRepository;
use UserBundle\Entity\user;

/**
 * ticketRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class ticketRepository extends EntityRepository {


    public function getTicketsUpcoming(user $user){
        return $this->createQueryBuilder('t')
            ->andWhere('t.userCreated = :inputUsername')
            ->andWhere('t.done = 0')
            ->andWhere('t.dateDeadline > :now')
            ->addOrderBy('t.dateDeadline', 'ASC')
            ->setParameter('inputUsername', $user->getId())
            ->setParameter('now', new \DateTime())
            ->getQuery()
            ->execute();
    }

    public function getTicketsOverdue(user $user) {
        return $this->createQueryBuilder('t')
            ->andWhere('t.userCreated = :inputUsername')
            ->andWhere('t.done = 0')
            ->andWhere('t.dateDeadline <= :now')
            ->addOrderBy('t.dateDeadline', 'ASC')
            ->setParameter('inputUsername', $user->getId())
            ->setParameter('now', new \DateTime())
            ->getQuery()
            ->execute();
    }

    public function getTicketsDone(user $user) {
        return $this->createQueryBuilder('t')
            ->andWhere('t.userCreated = :inputUsername')
            ->andWhere('t.done = 1')
            ->addOrderBy('t.dateDeadline', 'ASC')
            ->setParameter('inputUsername', $user->getId())
            ->getQuery()
            ->execute();
    }


    public function getTicketsUpcomingAdmin(){
        return $this->createQueryBuilder('t')
            ->andWhere('t.done = 0')
            ->andWhere('t.dateDeadline > :now')
            ->addOrderBy('t.dateDeadline', 'ASC')
            ->setParameter('now', new \DateTime())
            ->getQuery()
            ->execute();
    }

    public function getTicketsOverdueAdmin() {
        return $this->createQueryBuilder('t')
            ->andWhere('t.done = 0')
            ->andWhere('t.dateDeadline <= :now')
            ->addOrderBy('t.dateDeadline', 'ASC')
            ->setParameter('now', new \DateTime())
            ->getQuery()
            ->execute();
    }

    public function getTicketsDoneAdmin() {
        return $this->createQueryBuilder('t')
            ->andWhere('t.done = 1')
            ->addOrderBy('t.dateDeadline', 'ASC')
            ->getQuery()
            ->execute();
    }



    public function findAllTicketsAdmin(){
        return $this->createQueryBuilder('t')
            ->addOrderBy('t.dateDeadline', 'ASC')
            ->getQuery()
            ->execute();
    }

    public function findAllUpcomingTicketsUser(user $user) {
        return $this->createQueryBuilder('t')
            ->andWhere('t.userCreated = :inputUsername')
            ->andWhere('t.dateDeadline > :now')
            ->setParameter('inputUsername', $user->getId())
            ->setParameter('now', new \DateTime())
            ->getQuery()
            ->execute();

    }

    public function findAllOverdueTicketsUser(user $user) {
        return $this->createQueryBuilder('t')
            ->andWhere('t.userCreated = :inputUsername')
            ->andWhere('t.dateDeadline <= :now')
            ->setParameter('inputUsername', $user->getId())
            ->setParameter('now', new \DateTime())
            ->getQuery()
            ->execute();

    }

    public function findAllTicketsProject() {
        //todo in future, where orm will have project entity
    }

    public function testFind(){
        return $this->createQueryBuilder('t')
            ->addOrderBy('t.dateDeadline', 'ASC')
            ->andWhere('t.dateDeadline > :now')
            ->setParameter('now', new \DateTime())
            ->getQuery()
            ->execute();
    }

    public function findAllUpcomingTickets() {
        return $this->createQueryBuilder('t')
            ->addOrderBy('t.dateDeadline', 'ASC')
            ->andWhere('t.dateDeadline > :now')
            ->setParameter('now', new \DateTime())
            ->getQuery()
            ->execute();
    }

    public function findAllOverdueTickets() {
        return $this->createQueryBuilder('t')
            ->addOrderBy('t.dateDeadline', 'ASC')
            ->andWhere('t.dateDeadline <= :now')
            ->setParameter('now', new \DateTime())
            ->getQuery()
            ->execute();
    }

    public function findAllDoneTickets() {
        //todo when some enum will apear in ORM
    }

    public function findAllNotDoneTickets() {
        //todo when some enum will apear in ORM
    }

}
